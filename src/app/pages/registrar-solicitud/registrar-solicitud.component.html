<div class="tw-container mt-6 mb-10">
  <form [formGroup]="formGroup" (ngSubmit)="validateAndSubmit()" class="space-y-6">

    <!-- 1. Responsable -->
    <div class="tw-card">
      <label for="idInfoFrai" class="tw-section-title">
        1. FUNCIONARIO RESPONSABLE DE ENTREGA DE INFORMACIÓN:
      </label>
      <input id="idInfoFrai" class="tw-input mt-2" type="text" formControlName="nombreResponsable" [disabled]="true">
    </div>

    <!-- 2. Tipo de persona -->
    <div class="tw-card">
      <div class="tw-section-title">2. TIPO DE PERSONA:</div>

      <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
        <label class="flex items-center gap-2">
          <input type="radio" name="tipoPersona" class="tw-radio" formControlName="tipoPersona"
                  value="1" (change)="changeTipoPersona('1')" checked>
          <span>Persona Natural</span>
        </label>
        <label class="flex items-center gap-2">
          <input type="radio" name="tipoPersona" class="tw-radio" formControlName="tipoPersona"
                  value="2" (change)="changeTipoPersona('2')">
          <span>Persona Jurídica</span>
        </label>
      </div>

      <div *ngIf="formGroup.get('tipoPersona')?.errors && formGroup.get('tipoPersona')?.touched" class="tw-error">
        (*) Seleccione tipo de persona
      </div>
    </div>

    <div class="tw-divider"></div>

    <!-- 3. Persona Natural -->
    <div class="tw-card space-y-5" *ngIf="seccionDatosPersNatu">
      <div class="tw-section-title">3. DATOS DE PERSONA NATURAL:</div>

      <!-- Documento -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div>
          <label for="tipoDocumentoId" class="tw-label">Nro. de Documento:</label>
          <select id="tipoDocumentoId" class="tw-select"
                  formControlName="tipoDocumento" (change)="limpiarCampos()">
            <option value="null" disabled [selected]="true">TIPO DOCUMENTO</option>
            <option value="DNI">DNI</option>
            <option value="CE">CE</option>
            <option value="OTRO">OTRO</option>
          </select>
          <div *ngIf="formGroup.get('tipoDocumento')?.errors && formGroup.get('tipoDocumento')?.touched" class="tw-error">
            (*) Seleccione un tipo de documento
          </div>
        </div>

        <div class="md:col-span-2">
          <label for="idNroDocumento" class="tw-label">Número</label>
          <div class="flex gap-2">
            <input id="idNroDocumento" type="text" class="tw-input"
                    [maxlength]="documentNumberLengthMax" formControlName="nroDocumento"
                    oninput="this.value = this.value.replace(/[^0-9]/g, '');">
            <button *ngIf="formGroup.get('tipoDocumento')?.value=='DNI'"
                    type="button" class="tw-btn-primary"
                    (click)="buscarPersonaNatu()">
              Validar DNI
            </button>
          </div>

          <!-- Validaciones CE -->
          <div *ngIf="formGroup.get('nroDocumento')?.touched && formGroup.get('tipoDocumento')?.value=='CE'" class="tw-error">
            <span *ngIf="formGroup.get('nroDocumento')?.value?.length<9">(*) Mínimo 9 caracteres para CE</span>
            <span *ngIf="formGroup.get('nroDocumento')?.value?.length>12">(*) Máximo 12 caracteres para CE</span>
          </div>
          <!-- Validaciones OTRO -->
          <div *ngIf="formGroup.get('nroDocumento')?.touched && formGroup.get('tipoDocumento')?.value=='OTRO'" class="tw-error">
            <span *ngIf="formGroup.get('nroDocumento')?.value?.length<8">(*) Mínimo 8 caracteres para OTRO</span>
            <span *ngIf="formGroup.get('nroDocumento')?.value?.length>20">(*) Máximo 20 caracteres para OTRO</span>
          </div>
          <!-- Validaciones DNI / required -->
          <div *ngIf="formGroup.get('nroDocumento')?.errors && formGroup.get('nroDocumento')?.touched" class="tw-error">
            <span *ngIf="formGroup.get('nroDocumento')?.hasError('required')">(*) Digitar número de documento</span>
            <span *ngIf="formGroup.get('tipoDocumento')?.value=='DNI' && (formGroup.get('nroDocumento')?.hasError('minlength') || formGroup.get('nroDocumento')?.value?.length>8)">
              (*) Solo 8 caracteres permitidos para DNI
            </span>
          </div>
        </div>
      </div>

      <!-- Nombres -->
      <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
        <div>
          <label class="tw-label">Apellido Paterno:</label>
          <input type="text" class="tw-input" formControlName="apellidoPaterno"
                  onkeyup="this.value=this.value.toUpperCase();"
                  onkeypress="return ' áéíóúabcdefghijklmnñopqrstuvwxyzÁÉÍÓÚABCDEFGHIJKLMNÑOPQRSTUVWXYZ'.includes(event.key)">
          <div *ngIf="formGroup.get('apellidoPaterno')?.errors && formGroup.get('apellidoPaterno')?.touched" class="tw-error">
            (*) Digitar apellido paterno
          </div>
        </div>
        <div>
          <label class="tw-label">Apellido Materno:</label>
          <input type="text" class="tw-input" formControlName="apellidoMaterno"
                  onkeyup="this.value=this.value.toUpperCase();"
                  onkeypress="return ' áéíóúabcdefghijklmnñopqrstuvwxyzÁÉÍÓÚABCDEFGHIJKLMNÑOPQRSTUVWXYZ'.includes(event.key)">
          <div *ngIf="formGroup.get('apellidoMaterno')?.errors && formGroup.get('apellidoMaterno')?.touched" class="tw-error">
            (*) Digitar apellido materno
          </div>
        </div>
        <div>
          <label class="tw-label">Nombres:</label>
          <input type="text" class="tw-input" formControlName="nombres"
                  onkeyup="this.value=this.value.toUpperCase();"
                  onkeypress="return ' áéíóúabcdefghijklmnñopqrstuvwxyzÁÉÍÓÚABCDEFGHIJKLMNÑOPQRSTUVWXYZ'.includes(event.key)">
          <div *ngIf="formGroup.get('nombres')?.errors && formGroup.get('nombres')?.touched" class="tw-error">
            (*) Digitar nombres
          </div>
        </div>
      </div>

      <!-- Sexo -->
      <div>
        <label class="tw-label">Sexo:</label>
        <div class="flex gap-6">
          <label class="inline-flex items-center gap-2">
            <input type="radio" name="sexo" class="tw-radio" formControlName="sexo" value="M" checked>
            <span>Masculino</span>
          </label>
          <label class="inline-flex items-center gap-2">
            <input type="radio" name="sexo" class="tw-radio" formControlName="sexo" value="F">
            <span>Femenino</span>
          </label>
        </div>
      </div>
    </div>

    <!-- 3. Persona Jurídica -->
    <div class="tw-card space-y-5" *ngIf="seccionDatosPersNatu == false">
      <div class="tw-section-title">3. DATOS DE PERSONA JURÍDICA:</div>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div>
          <label for="idRuc" class="tw-label">R.U.C.</label>
          <div class="flex gap-2">
            <input id="idRuc" type="text" class="tw-input" formControlName="numeroRuc"
                    [maxlength]="11" minlength="11"
                    oninput="this.value = this.value.replace(/[^0-9]/g, '');">
            <button type="button" class="tw-btn-primary" (click)="buscarPersonaJuridica()">Validar</button>
          </div>
          <div *ngIf="formGroup.get('numeroRuc')?.errors && formGroup.get('numeroRuc')?.touched" class="tw-error">
            <span *ngIf="formGroup.get('numeroRuc')?.hasError('required')">(*) Número de RUC necesario</span>
            <span *ngIf="formGroup.get('numeroRuc')?.hasError('minlength') || formGroup.get('numeroRuc')?.value?.length > 11">
              (*) Solo 11 caracteres permitidos para RUC
            </span>
          </div>
        </div>

        <div class="md:col-span-2">
          <label for="idRazonSocial" class="tw-label">Razón Social:</label>
          <input id="idRazonSocial" type="text" class="tw-input bg-gray-50" [readonly]="true" formControlName="razonSocial">
          <div *ngIf="formGroup.get('razonSocial')?.errors && formGroup.get('razonSocial')?.touched" class="tw-error">
            (*) Nombre de razón social necesario
          </div>
        </div>
      </div>
    </div>

    <div class="tw-divider"></div>

    <!-- 4. Contacto -->
    <div class="tw-card space-y-5">
      <div class="tw-section-title">4. DATOS DE CONTACTO:</div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label class="tw-label">Dirección:</label>
          <input type="text" class="tw-input" formControlName="direccion"
                  onkeypress="return ' 0123456789áéíóúabcdefghijklmnñopqrstuvwxyzÁÉÍÓÚABCDEFGHIJKLMNÑOPQRSTUVWXYZ.'.includes(event.key)">
          <div *ngIf="formGroup.get('direccion')?.errors && formGroup.get('direccion')?.touched" class="tw-error">
            (*) Digitar una dirección
          </div>
        </div>

        <div>
          <label for="correoId" class="tw-label">Correo Electrónico:</label>
          <div class="flex gap-2">
            <input id="correoId" type="text" class="tw-input" formControlName="correo" [maxlength]="250">
            <!-- Botón borrar (SVG) -->
            <button type="button" class="tw-btn-ghost" title="Limpiar" (click)="limpiarCorreo()">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="currentColor">
                <path d="M6 7h12v12a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2V7zm3-4h6l1 1h4v2H2V4h4l1-1z"/>
              </svg>
            </button>
          </div>

          <div *ngIf="formGroup.get('correo')?.errors && formGroup.get('correo')?.touched" class="tw-error">
            <span *ngIf="formGroup.get('correo')?.hasError('required')">(*) Digitar un correo electrónico</span>
            <span *ngIf="formGroup.get('correo')?.hasError('email')">(*) Email inválido. Ej: persona@dominio.com</span>
          </div>

          <div *ngIf="!formGroup.get('correo')?.errors && !buttonDisabledEnviarCorreo && !loadingEnvioCorreo" class="tw-help">
            <span class="underline cursor-pointer text-blue-600 hover:text-blue-700"
                  (click)="enviarCorreoVerificacion()">Validar su correo electrónico</span>
          </div>
          <div *ngIf="!formGroup.get('correo')?.errors && loadingEnvioCorreo" class="mt-2 text-sm font-semibold text-green-600">
            Espere un momento por favor…
          </div>
          <div *ngIf="!formGroup.get('correo')?.errors && buttonDisabledEnviarCorreo && !CorreoValidado" class="tw-help">
            <span class="underline cursor-pointer text-blue-600 hover:text-blue-700"
                  (click)="validarVerificacionCorreo()">Validar la confirmación de su correo electrónico</span>
          </div>
          <div *ngIf="!formGroup.get('correo')?.errors && CorreoValidado" class="mt-2 text-base font-semibold text-green-600">
            Su correo electrónico ha sido validado.
          </div>
        </div>

        <div>
          <label class="tw-label">Ubicación:</label>
          <div class="flex flex-col sm:flex-row gap-2">
            <select id="departamentoId" class="tw-select" formControlName="departamento" (change)="buscarProvincia()">
              <option value="null" disabled [selected]="true">DEPARTAMENTO</option>
              <option *ngFor="let item of listaDepartamentos" [value]="item.departamentoID">{{item.nombreDepartamento}}</option>
            </select>
            <select id="provinciaId" class="tw-select" formControlName="provincia" (change)="buscarDistrito()">
              <option value="null" disabled [selected]="true">PROVINCIA</option>
              <option *ngFor="let item of listaProvincia" [value]="item.provinciaID">{{item.nombreProvincia}}</option>
            </select>
            <select id="distritoId" class="tw-select" formControlName="distrito">
              <option value="null" disabled [selected]="true">DISTRITO</option>
              <option *ngFor="let item of listaDistrito" [value]="item.distritoID">{{item.nombreDistrito}}</option>
            </select>
          </div>

          <div *ngIf="formGroup.get('departamento')?.errors && formGroup.get('departamento')?.touched" class="tw-error">(*) Seleccione un Departamento</div>
          <div *ngIf="formGroup.get('provincia')?.errors && formGroup.get('provincia')?.touched" class="tw-error">(*) Seleccione una Provincia</div>
          <div *ngIf="formGroup.get('distrito')?.errors && formGroup.get('distrito')?.touched" class="tw-error">(*) Seleccione un Distrito</div>
        </div>

        <div>
          <label class="tw-label">Teléfono / Celular:</label>
          <input type="text" class="tw-input" formControlName="celular"
                  [maxlength]="9" onkeypress="return ' 0123456789'.includes(event.key)">
          <div *ngIf="formGroup.get('celular')?.errors && formGroup.get('celular')?.touched" class="tw-error">
            <span *ngIf="formGroup.get('celular')?.hasError('required')">(*) Digitar un número de teléfono</span>
            <span *ngIf="formGroup.get('celular')?.hasError('minlength')">(*) 8 dígitos (fijo) o 9 (celular)</span>
          </div>
        </div>
      </div>
    </div>

    <div class="tw-divider"></div>

    <!-- 5. Detalle -->
    <div class="tw-card space-y-5">
      <div class="tw-section-title">5. DETALLE DE LA INFORMACIÓN SOLICITADA:</div>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-4 items-end">
        <div><label class="tw-label">Seleccionar tipo de entrega:</label></div>
        <div>
          <select id="formaEntrega" class="tw-select" formControlName="formaEntregaID" (change)="cambioTipoEntrega()">
            <option value="null" disabled [selected]="true">TIPO ENTREGA</option>
            <option *ngFor="let item of listaTiposEntrega" [value]="item.formaEntregaID">{{item.descripcion}}</option>
          </select>
          <div *ngIf="formGroup.get('formaEntregaID')?.errors && formGroup.get('formaEntregaID')?.touched" class="tw-error">
            (*) Seleccione una forma de entrega
          </div>
        </div>
        <div class="md:col-span-3" *ngIf="mostrarMensajeCosto">
          <p class="text-sm text-red-600">
            (*) Para el envío por el medio seleccionado, deberá realizar un pago; se informará por correo en los próximos días.
          </p>
        </div>
      </div>

      <div>
        <label for="idInformacionSolicitada" class="tw-label">Información Solicitada:</label>
        <textarea id="idInformacionSolicitadamb-10" class="tw-textarea" formControlName="informacionSolicitada"></textarea>
        <div *ngIf="formGroup.get('informacionSolicitada')?.errors && formGroup.get('informacionSolicitada')?.touched" class="tw-error">
          (*) Ingrese lo que solicita
        </div>
      </div>
    </div>

    <!-- Declaración jurada -->
    <div class="tw-card">
      <label class="inline-flex items-start gap-3">
        <input type="checkbox" id="declaracionJuradaId" class="tw-checkbox mt-1"
                formControlName="declaracionJurada" required>
        <span class="text-sm text-gray-700">
          Estoy de acuerdo con la
          <u class="underline cursor-pointer text-blue-600 hover:text-blue-700" (click)="openDialogTermyCond()">Declaración Jurada</u>
        </span>
      </label>
      <div *ngIf="formGroup.get('declaracionJurada')?.errors && formGroup.get('declaracionJurada')?.touched" class="tw-error">
        (*) Debe aceptar la declaración jurada
      </div>
    </div>

    <!-- Acciones -->
    <div class="tw-actions justify-center">
      <button type="button" class="tw-btn bg-red-600 text-white hover:bg-red-700"
              [routerLink]="'/Inicio'">
        Cancelar Registro
      </button>
      <button type="submit" class="tw-btn-primary"
              [disabled]="buttonDisabled" (click)="validarEnvio()">
        Registrar Solicitud
      </button>
    </div>

  </form>
</div>
